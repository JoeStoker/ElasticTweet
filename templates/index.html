<!-- <html>
<header>
	<title>ElasticTweet</title>

	<link rel="stylesheet" href="static/css/bootstrap.min.css">
	<link rel="stylesheet" href="static/css/style.css">
	<script src="static/js/jquery-3.3.1.min.js"></script>
	<script src="static/js/bootstrap.min.js"></script>
	</header>
<body>
Keyword: <input id="keyword_input" type="text" name="keyword"><br>
<br><br><br>
How many tweets to display? <input id="hmt_keyword" type="number" name="hmt" value=10><br>
<input id="submit_keyword" type="submit" value="Submit"><br><br>
<input id="clear_results" type="submit" value="Clear results"><br><br>
Index: <input id="index_input" type="text" name="index"> <input name="index" id="push_to_es" type="submit" value="Push results to Elasticsearch"><br><br>

<br><br><br>
<div id="loading" style="display:none;">
	Loading, this may take a while...
</div>
<div id="tweets">
</div>
</body>

<script>

$(document).ready(function(){
	$("#clear_results").click(function(){
		document.getElementById("tweets").innerHTML = "";
		tweet_response = null;
	});
});

function es_validation() {
	if ($("#index_input").val() == "") {
		alert("Please enter an index!");
		return false;
	}
	if (tweet_response == null) {
		alert("You must search for something.");
		return false;
	}
	return true;
}

$(document).ready(function(){
	$("#push_to_es").click(function(){
		if (!es_validation()) {
			return;
		}
		$.ajax({
			type : 'POST',
			url : "{{url_for('push_to_es')}}",
  			data : {'tweets':tweet_response,
  					'index':$("#index_input").val()},
  			success: function(response) {
  				alert("data successfully pushed to Elasticsearch!");
            },
            error: function(error) {
                alert(error);
            }
		});
	});
});

var tweet_response = null;
$(document).ready(function(){
	$("#submit_keyword").click(function(){
		document.getElementById("loading").style.display="block";
		document.getElementById("tweets").innerHTML = "";
		$.ajax({
			type : 'POST',
			url : "{{url_for('submit_keyword')}}",
  			data : {'keyword':$("#keyword_input").val(),
  					'hmt':$("#hmt_keyword").val()},
  			success: function(response) {
  				document.getElementById("loading").style.display="none";
  				tweet_response = response;
                resp = jQuery.parseJSON(response);
                tweets = resp["tweets"];
                if (tweets.length == 0) {
                	var $newdiv = $( "<div id='no_tweets'>No tweets to display.</div><br><br>" );
                	$("#tweets").append($newdiv);
                	tweet_response = null;
                }
                for (var i = 0; i < tweets.length; i++) {
                	var $newdiv = $( "<div id='tweet"+i+"'>Name: "+tweets[i][1]+"<br>Tweet "+(i+1)+": "+tweets[i][0]+"</div><br><br>" );
                	$("#tweets").append($newdiv);
                }
            },
            error: function(error) {
                document.getElementById("loading").style.display="none";
                var $newdiv = $( "<div id='error_tweets'>An error seems to have occured.</div><br><br>" );
                $("#tweets").append($newdiv);
            }
		});
	});
});

$(document).ready(function() {
    $("#htm").keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
             // Allow: Ctrl/cmd+A
            (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+C
            (e.keyCode == 67 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+X
            (e.keyCode == 88 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
                 return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    });
});
</script>
</html> -->


<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ElasticTweet</title>
  <meta name="description" content="A free and modern UI toolkit for web makers based on the popular Bootstrap 4 framework.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="static/css/shards.min.css?v=2.0.1">
  <link rel="stylesheet" href="static/css/shards-demo.css?v=2.0.1">
</head>

<body>
  <div class="loader">
    <div class="page-loader"></div>
  </div>

  <!-- Floating Shards -->
  <!-- <img src="images/demo/shard-1-5x-3.png" alt="Shard" class="shard"> -->

  <!-- Welcome Section -->
  <div class="welcome d-flex justify-content-center flex-column">
    <div class="inner-wrapper mt-auto mb-auto">
      <h1 class="slide-in">ElasticTweet</h1>
      <p class="slide-in">Easily import tweet data into ElasticSearch.</p>
      <div class="action-links slide-in">
        <a href="#" data-scroll-to="#introduction" id="scroll-to-content" class="btn btn-outline-light btn-pill align-self-center">Use app</a>
      </div>
    </div>
  </div>

  <!-- Page Content -->
  <div id="introduction"></div>
      
  <!-- Cards -->
  <div id="cards" class="container mb-2" style="padding-bottom: 1px">
    <div class="example col-md-12 ml-auto mr-auto">
      <div class="row">
        <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Specify keyword</h4>
              <div class="form-group col-md-12">
                <label for="form1-name" class="col-form-label">Keyword</label>
                <input type="text" class="form-control" id="keyword_input" placeholder="">
              </div>
              <div class="form-group col-md-12">
                <label for="form1-name" class="col-form-label">Number of tweets</label>
                <input type="text" class="form-control" id="hmt" value="100">
              </div>
              <button id="submit_keyword" type="button" style="width:49%" class="form-control btn btn-secondary">Get tweets</button>
             <!--  <button id="clear_results" type="button" style="width:26%" class="form-control btn btn-secondary">Clear</button> -->
              <button id="history" type="button" style="width:49%" class="form-control btn btn-secondary">History</button>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6 col-sm-12 mb-4 sm-hidden">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Push to ElasticSearch</h4>
              <div class="form-group col-md-12">
                <label for="form1-name" class="col-form-label">Index</label>
                <input type="text" class="form-control" id="index_input" placeholder="">
              </div>
              <div class="form-group col-md-12">
                <label for="form1-name" class="col-form-label">Doc_type</label>
                <input type="text" class="form-control" id="doc_type_input" placeholder="">
              </div>
                <button id="push_to_es" type="button" style="margin-left:35%; margin-right:35%" class="col-md-3 form-control btn btn-secondary">Push</button>

            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6 col-sm-12 mb-4 sm-hidden">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">ES Configurations</h4>
              <div class="form-group col-md-12">
                <label for="form1-name" class="col-form-label">Host</label>
                <input type="text" class="form-control" value="127.0.0.1" id="es_host_input" placeholder="">
              </div>
              <div class="form-group col-md-12">
                <label for="form1-name" class="col-form-label">Port</label>
                <input type="text" class="form-control" value="9200" id="es_port_input" placeholder="">
              </div>
              <button id="open_es" type="button" style="width:49%" class="form-control btn btn-secondary">Open ES</button>
              <button data-toggle="modal" data-target="#kibanaModal" type="button" style="width:49%" class="form-control btn btn-secondary">Open Kibana</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

	<div id="loading" style="display:none;">
		Loading, this may take a while...
	</div>
	<div id="tweets">
	</div>
      <!-- Typography -->
  <div id="typography" class="container mb-2">
    <h5 style="text-align: center">Results</h3>
  

    <div class="example col-md-12 ml-auto mr-auto">
      <table class="table table-striped table-responsive-md" id="results_table">
        <thead>
          <tr>
            <th>Twitter name</th>
            <th>Twitter handle</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody id="results_table_body">
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td>
              
            </td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- gifs: http://www.studentshow.com/gallery/31234507/Free-Loading-GIF-Icons-Vol-1 -->
<div class="mb-5">

  <!-- Modal Body -->
  <div class="modal fade" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">This may take a few moments...</h5>
        </div>
        <img id="loading_gif_0" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/0.gif" alt="Preloader">
        <img id="loading_gif_1" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/1.gif" alt="Preloader">
        <img id="loading_gif_2" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/2.gif" alt="Preloader">
        <img id="loading_gif_3" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/3.gif" alt="Preloader">
        <img id="loading_gif_4" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/4.gif" alt="Preloader">
        <img id="loading_gif_5" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/5.gif" alt="Preloader">
        <img id="loading_gif_6" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/6.gif" alt="Preloader">
        <img id="loading_gif_7" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/7.gif" alt="Preloader">
        <img id="loading_gif_8" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/8.gif" alt="Preloader">
        <img id="loading_gif_9" style="display:none;margin-left:auto; margin-right:auto;width:256px;height:256px;" src="../static/img/9.gif" alt="Preloader">
      </div>
    </div>
  </div>
</div>


<div class="mb-5">

  <!-- Modal Body -->
  <div class="modal fade" id="historyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Search history:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="history_modal_body">
          
        </div>
      </div>
    </div>
  </div>
</div>



<div class="mb-5">

  <!-- Modal Body -->
  <div class="modal fade" id="kibanaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Please specify the following Kibana details:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group col-md-12">
            <label for="form1-name" class="col-form-label">Host</label>
            <input type="text" class="form-control" value="127.0.0.1" id="kibana_host_input" placeholder="">
          </div>
          <div class="form-group col-md-12">
            <label for="form1-name" class="col-form-label">Port</label>
            <input type="text" class="form-control" value="5601" id="kibana_port_input" placeholder="">
          </div>
        </div>
        <div class="modal-footer">
          <button id="open_kibana" type="button" style="width:49%" class="form-control btn btn-secondary">Open Kibana</button>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- JavaScript -->
  <div id="fb-root"></div>
  <script>
    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=1662270373824826";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

  </script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script src="static/js/shards.min.js"></script>
  <script src="static/js/demo.min.js"></script>

</body>
<script>


$(document).ready(function(){
  $("#history").click(function(){
    $.ajax({
      type : 'GET',
      url : "{{url_for('history')}}",
      success: function(response) {
        resp = jQuery.parseJSON(response);
        hist = resp["history"];
        for (var i = 0; i < hist.length; i++) {
          $('#history_modal_body').append('<div class="form-group col-md-12">'+hist[i]+'</div>');
          $("#historyModal").modal('show');
        }
      },
      error: function(error) {
          alert("An error has occured.");
      }
    });
  });
});

$(document).ready(function(){
	$("#clear_results").click(function(){
		clear();
	});
});

$(document).ready(function(){
  $("#open_es").click(function(){
    var win = window.open('http://'+$("#es_host_input").val()+":"+$("#es_port_input").val(), '_blank');
    if (win) {
        //Browser has allowed it to be opened
        win.focus();
    } else {
        //Browser has blocked it
        alert('Error: Please ensure the ES configurations are correct');
    }
  });
});


$(document).ready(function(){
  $("#open_kibana").click(function(){
    var win = window.open('http://'+$("#kibana_host_input").val()+":"+$("#kibana_port_input").val(), '_blank');
    if (win) {
        //Browser has allowed it to be opened
        win.focus();
    } else {
        //Browser has blocked it
        alert('Error: Please ensure the Kibana configurations are correct');
    }
  });
});


function clear() {
  document.getElementById("results_table_body").innerHTML = "";
}

function es_validation() {
	if ($("#index_input").val() == "") {
		alert("Please enter an index!");
		return false;
	}
  if ($("#doc_type_input").val() == "") {
    alert("Please enter a doc_type!");
    return false;
  }
	if (tweet_response == null) {
		alert("You must search for something.");
		return false;
	}
	return true;
}

$(document).ready(function(){
	$("#push_to_es").click(function(){
		if (!es_validation()) {
			return;
		}
		$.ajax({
			type : 'POST',
			url : "{{url_for('push_to_es')}}",
			data : {'tweets':tweet_response,
					'index':$("#index_input").val(),
          'doc_type':$("#doc_type_input").val(),
          'es_host':$("#es_host_input").val(),
          'es_port':$("#es_port_input").val()},
			success: function(response) {
				alert("Data successfully pushed to Elasticsearch!");
      },
      error: function(error) {
          alert("An error has occured.");
      }
		});
	});
});

var tweet_response = null;
$(document).ready(function(){
	$("#submit_keyword").click(function(){
    if ($("#keyword_input").val() == "") {
      alert("Please specify a keyword.");
      return;
    }
		// document.getElementById("loading").style.display="block";
    $('#loadingModal').modal('show');
    var gif_id = parseInt(Math.random()*10);
    document.getElementById("loading_gif_"+gif_id).style.display="block";
		clear();
		$.ajax({
			type : 'POST',
			url : "{{url_for('submit_keyword')}}",
  			data : {'keyword':$("#keyword_input").val(),
  					'hmt':$("#hmt").val()},
  			success: function(response) {
  				// document.getElementById("loading").style.display="none";
          $('#loadingModal').modal('hide');
          document.getElementById("loading_gif_"+gif_id).style.display="none";
  				tweet_response = response;
          resp = jQuery.parseJSON(response);
          tweets = resp["tweets"];
          if (tweets.length == 0) {
          	alert("No tweets to display!");
          }
          populate_results_table(tweets);
      },
      error: function(error) {
          $('#loadingModal').modal('hide');
          document.getElementById("loading_gif_"+gif_id).style.display="none";
          alert("An error has occured.");
      }
		});
	});
});

function populate_results_table(tweets) {
  clear();
  for (var i = 0; i < tweets.length; i++) {
    $('#results_table > tbody:last-child').append('<tr><td>'+tweets[i][0]+'</td><td>'+tweets[i][1]+'</td><td>'+tweets[i][2]+'</td></tr>');
  }
}

$(document).ready(function() {
    $("#hmt").keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
             // Allow: Ctrl/cmd+A
            (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+C
            (e.keyCode == 67 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+X
            (e.keyCode == 88 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
                 return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    });
});
</script>
</html>
